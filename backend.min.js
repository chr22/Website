/*! SvejstrupsPlayground 2014-01-04 */
module.exports=function(a){var b=require("express"),c=require("connect-mongo")(b),d=require("./auth"),e=require("./routes"),f=require("./routes/posts"),g=(require("./routes/schedules"),require("./routes/reports")),h=(require("./routes/comments"),require("path")),i=b();return i.set("port",process.env.PORT||3e3),i.set("views",__dirname+"/views"),i.set("view engine","jade"),i.use(b.favicon(h.join(__dirname+"/public/images/favicon.png"))),i.use(b.logger("dev")),i.use(b.cookieParser()),i.use(b.session({secret:"verySecret",store:new c({mongoose_connection:a})})),i.use(d.initialize()),i.use(d.session()),i.use(b.bodyParser()),i.use(b.methodOverride()),i.use(function(a,b,c){b.set("X-Powered-By","Svejstrups Playground"),c()}),i.use(i.router),i.use(b.static(h.join(__dirname,"public"))),"development"===i.get("env")&&i.use(b.errorHandler()),"production"===i.get("env"),i.get("/",e.index),i.get("/partials/:name",e.partials),i.get("/partials/posts/:name",e.posts),i.get("/partials/schedules/:name",e.schedules),i.get("/partials/reports/:name",e.reports),i.get("/partials/comments/:name",e.comments),i.get("/login",e.login),i.post("/login",d.authenticate("local"),function(a,b){console.log(a.user),b.json("true")}),i.get("/user",e.user),i.get("/posts/posts",f.posts),i.get("/posts/post/:id",f.post),i.post("/posts/post",f.addPost),i.put("/posts/post/:id",f.editPost),i.delete("/posts/post/:id",f.deletePost),i.get("/reports/reports",g.reports),i.get("/reports/reportsWithComments",g.reportsWithComments),i.get("/reports/report/:id",g.report),i.get("/reports/reportWithComments/:id",g.report),i.post("/reports/addReport",g.addReport),i.put("/reports/editReport",g.editReport),i.delete("/reports/deleteReport",g.deleteReport),i.delete("/reports/deleteReports",g.deleteReports),i},exports.index=function(a,b){b.render("index")},exports.partials=function(a,b){var c=a.params.name;console.log("name: "+c),b.render("partials/"+c)},exports.posts=function(a,b){var c=a.params.name;b.render("partials/posts/"+c)},exports.schedules=function(a,b){var c=a.params.name;b.render("partials/schedules/"+c)},exports.reports=function(a,b){var c=a.params.name;b.render("partials/reports/"+c)},exports.comments=function(a,b){var c=a.params.name;b.render("partials/comments/"+c)},exports.login=function(a,b){console.log("in login"),b.render("partials/login")},exports.user=function(a,b){console.log("user"),void 0===a.session.passport.user?b.redirect("/login"):b.render("partials/"+name)};var mongoskin=require("mongoskin"),db=mongoskin.db("localhost:27017/website",{safe:!0}),posts=db.collection("posts");exports.posts=function(a,b){console.log("in posts"),posts.find().toArray(function(a,c){if(a)throw a;b.json({posts:c})})},exports.post=function(a,b){posts.findById(db.ObjectID.createFromHexString(a.params.id),function(a,c){if(a)throw a;b.json({post:c})})},exports.addPost=function(a,b){posts.insert(a.body,null,function(a,c){if(a)throw a;b.json(c)})},exports.editPost=function(a,b){delete a.body._id,posts.updateById(db.ObjectID.createFromHexString(a.params.id),{$set:a.body},{safe:!0,multi:!1},function(a,c,d){if(a)throw a;b.json(d)})},exports.deletePost=function(a,b){posts.removeById(db.ObjectID.createFromHexString(a.params.id),function(a){if(a)throw a;b.json(!0)})};