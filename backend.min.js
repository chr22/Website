/*! SvejstrupsPlayground 2013-12-29 */
var express=require("express"),routes=require("./routes"),posts=require("./routes/posts"),schedules=require("./routes/schedules"),http=require("http"),path=require("path"),app=module.exports=express();app.set("port",process.env.PORT||3e3),app.set("views",__dirname+"/views"),app.set("view engine","jade"),app.use(express.logger("dev")),app.use(express.bodyParser()),app.use(express.methodOverride()),app.use(express.static(path.join(__dirname,"public"))),app.use(app.router),"development"===app.get("env")&&app.use(express.errorHandler()),"production"===app.get("env"),app.get("/",routes.index),app.get("/partials/:name",routes.partials),app.get("/posts/posts",posts.posts),app.get("/posts/post/:id",posts.post),app.post("/posts/post",posts.addPost),app.put("/posts/post/:id",posts.editPost),app.delete("/posts/post/:id",posts.deletePost),http.createServer(app).listen(8888,function(){console.log("Express server listening on port 8888")}),exports.index=function(a,b){b.render("index")},exports.partials=function(a,b){var c=a.params.name;b.render("partials/"+c)};var mongoskin=require("mongoskin"),db=mongoskin.db("localhost:27017/blog",{safe:!0}),posts=db.collection("posts");exports.posts=function(a,b){posts.find().toArray(function(a,c){if(a)throw a;b.json({posts:c})})},exports.post=function(a,b){posts.findById(db.ObjectID.createFromHexString(a.params.id),function(a,c){if(a)throw a;b.json({post:c})})},exports.addPost=function(a,b){posts.insert(a.body,null,function(a,c){if(a)throw a;b.json(c)})},exports.editPost=function(a,b){delete a.body._id,posts.updateById(db.ObjectID.createFromHexString(a.params.id),{$set:a.body},{safe:!0,multi:!1},function(a,c,d){if(a)throw a;b.json(d)})},exports.deletePost=function(a,b){posts.removeById(db.ObjectID.createFromHexString(a.params.id),function(a){if(a)throw a;b.json(!0)})};